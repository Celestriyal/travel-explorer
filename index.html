<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Travel Explorer</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
/* --- Mobile App Theme: Red & White --- */
* { margin:0; padding:0; box-sizing:border-box; }
body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #fff5f5, #ffe6e6);
    color: #222;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:20px;
}
h1 { font-size:2.5em; color:#d32f2f; text-align:center; margin-bottom:15px;}
input, button { padding:10px 15px; border-radius:8px; border:none; font-size:1em; margin:5px; }
input { width:70%; max-width:300px; box-shadow:0 3px 10px rgba(0,0,0,0.1); }
input:focus { outline:none; box-shadow:0 5px 15px rgba(0,0,0,0.2);}
button { background:#d32f2f; color:white; font-weight:bold; cursor:pointer; transition:0.3s; }
button:hover { background:#b71c1c; transform:translateY(-2px); }
#info { width:100%; max-width:800px; margin-top:20px; }
.card { background:white; padding:20px; margin:15px 0; border-radius:15px; 
       box-shadow:0 8px 25px rgba(0,0,0,0.15); transition:0.3s; }
.card:hover { transform:translateY(-3px); box-shadow:0 12px 35px rgba(0,0,0,0.2); }
.card h2 { color:#d32f2f; margin-bottom:10px; border-bottom:2px solid #d32f2f33; padding-bottom:5px; }
#map { height:300px; width:100%; border-radius:15px; margin-top:15px; }
@media(max-width:768px){ input { width:80%; } }
</style>
</head>
<body>

<h1>Travel Explorer</h1>
<div>
    <input type="text" id="cityInput" placeholder="Enter city name">
    <button onclick="searchCity()">Explore City</button>
    <button onclick="exploreLocation()">Use My Location</button>
</div>

<div id="info">Information will appear here.</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// --- Clean Wikipedia Extract ---
async function cleanText(text){
    return text
        .replace(/\s*\(.*?IPA.*?\)/g,'')
        .replace(/\s*\(.*?pronunciation.*?\)/gi,'')
        .replace(/\s*\(.*?\)/g,'')
        .replace(/\[\d+\]/g,'')
        .replace(/\n+/g,'\n')
        .trim();
}

// --- Fetch City Info ---
async function fetchCityInfo(city){
    const infoDiv = document.getElementById('info');
    try{
        // Loading
        infoDiv.innerHTML = "<div class='card'><h2>Loading...</h2><p>Fetching information for "+city+"...</p></div>";

        // Coordinates from Nominatim
        const nomRes = await fetch(`https://nominatim.openstreetmap.org/search?city=${encodeURIComponent(city)}&format=json&limit=1`);
        const nomData = await nomRes.json();
        if(nomData.length === 0){
            infoDiv.innerHTML = "<p>City not found. Please enter a valid city.</p>";
            return;
        }
        const lat = nomData[0].lat;
        const lon = nomData[0].lon;
        const cityName = nomData[0].display_name.split(',')[0];

        // Wikipedia extract
        const wikiRes = await fetch(`https://en.wikipedia.org/w/api.php?action=query&format=json&prop=extracts|pageimages|categories&titles=${encodeURIComponent(cityName)}&exintro=1&explaintext=1&piprop=original&origin=*`);
        const wikiData = await wikiRes.json();
        const page = Object.values(wikiData.query.pages)[0];
        let extract = page.extract ? await cleanText(page.extract) : null;

        // Display main info
        infoDiv.innerHTML = `<div class="card">
                                <h2>${cityName}</h2>
                                ${page.original?.source ? `<img src="${page.original.source}" style="width:100%;border-radius:12px;margin-bottom:10px;">` : ""}
                                <p>${extract || 'No Wikipedia information available.'}</p>
                             </div>`;

        // Fun Facts
        const funFacts = extract ? extract.split('. ').slice(1,4).join('. ') : await fetchFunFacts(cityName);
        infoDiv.innerHTML += `<div class="card"><h2>Fun Facts</h2><p>${funFacts}</p></div>`;

        // Landmarks: fetch major buildings/POIs from OpenStreetMap around city
        const landmarks = await fetchLandmarks(cityName, lat, lon);
        infoDiv.innerHTML += `<div class="card"><h2>Major Landmarks</h2><p>${landmarks}</p></div>`;

        // Must-Do
        const mustDo = await fetchMustDo(cityName);
        infoDiv.innerHTML += `<div class="card"><h2>Must-Do Activities</h2><p>${mustDo}</p></div>`;

        // Map
        infoDiv.innerHTML += `<div class="card"><h2>Map</h2><div id="map"></div></div>`;
        const map = L.map('map').setView([lat, lon],12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
            attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);
        L.marker([lat, lon]).addTo(map).bindPopup(cityName).openPopup();

    }catch(err){
        infoDiv.innerHTML = `<p>Error fetching city information: ${err}</p>`;
    }
}

// Placeholder: Fun facts
async function fetchFunFacts(city){ return `Some unique and interesting fun facts about ${city}.`; }

// Landmarks from OpenStreetMap (tourism, historic, attraction)
async function fetchLandmarks(city, lat, lon){
    try{
        const osmRes = await fetch(`https://overpass-api.de/api/interpreter?data=[out:json];node(around:5000,${lat},${lon})[tourism];out;`);
        const osmData = await osmRes.json();
        const names = osmData.elements.map(e=>e.tags.name).filter(n=>n).slice(0,10);
        return names.length ? names.join(', ') : `No major landmarks found in ${city}.`;
    }catch(e){
        return `Unable to fetch landmarks for ${city}.`;
    }
}

// Must-Do activities placeholder
async function fetchMustDo(city){
    return `Top things to do in ${city}: Visit local markets, try local food, explore historic areas, and enjoy cultural events.`;
}

// Search city
function searchCity(){
    const city = document.getElementById('cityInput').value.trim();
    if(!city) return alert("Please enter a city name.");
    fetchCityInfo(city);
}

// Use user's location
function exploreLocation(){
    const infoDiv = document.getElementById('info');
    if(!navigator.geolocation) return alert("Geolocation not supported.");
    infoDiv.innerHTML = "<div class='card'><h2>Locating...</h2><p>Determining your location...</p></div>";
    navigator.geolocation.getCurrentPosition((pos)=>{
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`).then(res=>res.json())
            .then(data=>{
                const city = data.address.city || data.address.town || data.address.village || data.address.county;
                if(!city) return alert("Could not detect city name.");
                fetchCityInfo(city);
            }).catch(err=>alert("Error detecting city name."));
    }, (err)=>{
        alert("Error getting location: "+err.message);
    });
}
</script>
</body>
</html>
